<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Committing back to subversion &mdash; Gitting boost</title>
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.0',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Gitting boost" href="index.html" />
    <link rel="next" title="SVN Command equivalents" href="svn_equivs.html" />
    <link rel="prev" title="Do some development" href="development.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="svn_equivs.html" title="SVN Command equivalents"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="development.html" title="Do some development"
             accesskey="P">previous</a> |</li>
    <li><a href="http://www.boost.org/">Boost</a> &raquo;</li>
    
        <li><a href="index.html">Gitting boost</a> &raquo;</li>
 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/boost-small.png" alt="Logo"/>
            </a></p>
            <h4>Previous topic</h4>
            <p class="topless"><a href="development.html"
                                  title="previous chapter">Do some development</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="svn_equivs.html"
                                  title="next chapter">SVN Command equivalents</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/subversion.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="committing-back-to-subversion">
<h1>Committing back to subversion<a class="headerlink" href="#committing-back-to-subversion" title="Permalink to this headline">Â¶</a></h1>
<p>I have a clean updated svn trunk checkout at <tt class="docutils literal"><span class="pre">/tmp/svn</span></tt>.  I&#8217;m in git
and have some local changes.  As an example I&#8217;ll pull some
<tt class="docutils literal"><span class="pre">CMakeLists.txt</span></tt> over from the release branch to the trunk:</p>
<div class="highlight-git_shell"><div class="highlight"><pre><span class="k">% git</span><span class="g-Whitespace"> </span><span class="gd">checkout </span>svn/release<span class="g-Whitespace"> </span>libs/flyweight/CMakeLists.txt<span class="g-Whitespace"> </span>libs/flyweight/test/CMakeLists.txt<span class="g-Whitespace"> </span>CMakeLists.txt<span class="g-Whitespace"></span>
<span class="k">% git</span><span class="g-Whitespace"> </span><span class="gd">add </span>libs/flyweight/CMakeLists.txt<span class="g-Whitespace"> </span>libs/flyweight/test/CMakeLists.txt<span class="g-Whitespace"> </span>CMakeLists.txt<span class="g-Whitespace"></span>
<span class="k">% git</span><span class="g-Whitespace"> </span><span class="gd">status</span>
<span class="go">#</span><span class="g-Whitespace"> </span><span class="go">On</span><span class="g-Whitespace"> </span><span class="go">branch</span><span class="g-Whitespace"> </span><span class="go">mytweaks</span><span class="g-Whitespace"></span>
<span class="go">#</span><span class="g-Whitespace"> </span><span class="go">Changes</span><span class="g-Whitespace"> </span><span class="go">to</span><span class="g-Whitespace"> </span><span class="go">be</span><span class="g-Whitespace"> </span><span class="go">committed:</span><span class="g-Whitespace"></span>
<span class="go">#</span><span class="g-Whitespace">   </span><span class="go">(use</span><span class="g-Whitespace"> </span><span class="go">&quot;git</span><span class="g-Whitespace"> </span><span class="go">reset</span><span class="g-Whitespace"> </span><span class="go">HEAD</span><span class="g-Whitespace"> </span><span class="go">&lt;file&gt;...&quot;</span><span class="g-Whitespace"> </span><span class="go">to</span><span class="g-Whitespace"> </span><span class="go">unstage)</span><span class="g-Whitespace"></span>
<span class="go">#</span><span class="g-Whitespace"></span>
<span class="go">#</span><span class="g-Whitespace">       </span><span class="go">modified:</span><span class="g-Whitespace">   </span><span class="go">CMakeLists.txt</span><span class="g-Whitespace"></span>
<span class="go">#</span><span class="g-Whitespace">       </span><span class="go">new</span><span class="g-Whitespace"> </span><span class="go">file:</span><span class="g-Whitespace">   </span><span class="go">libs/flyweight/CMakeLists.txt</span><span class="g-Whitespace"></span>
<span class="go">#</span><span class="g-Whitespace">       </span><span class="go">new</span><span class="g-Whitespace"> </span><span class="go">file:</span><span class="g-Whitespace">   </span><span class="go">libs/flyweight/test/CMakeLists.txt</span><span class="g-Whitespace"></span>
<span class="go">#</span><span class="g-Whitespace"></span>
<span class="k">% git</span><span class="g-Whitespace"> </span><span class="gd">commit </span><span class="o">-m </span>&quot;moving<span class="g-Whitespace"> </span>cmakefiles<span class="g-Whitespace"> </span>release-&gt;trunk&quot;<span class="g-Whitespace"></span>
</pre></div>
</div>
<p>You can easily format a patch to transform the svn trunk into your current branch:</p>
<div class="highlight-git_shell"><div class="highlight"><pre><span class="k">% git</span><span class="g-Whitespace"> </span><span class="gd">diff </span><span class="o">-p </span>svn/master<span class="g-Whitespace"></span>
<span class="go">diff</span><span class="g-Whitespace"> </span><span class="go">--git</span><span class="g-Whitespace"> </span><span class="go">a/CMakeLists.txt</span><span class="g-Whitespace"> </span><span class="go">b/CMakeLists.txt</span><span class="g-Whitespace"></span>
<span class="go">index</span><span class="g-Whitespace"> </span><span class="go">5e521ad..e4ddc93</span><span class="g-Whitespace"> </span><span class="go">100644</span><span class="g-Whitespace"></span>
<span class="go">---</span><span class="g-Whitespace"> </span><span class="go">a/CMakeLists.txt</span><span class="g-Whitespace"></span>
<span class="go">+++</span><span class="g-Whitespace"> </span><span class="go">b/CMakeLists.txt</span><span class="g-Whitespace"></span>
<span class="go">@@</span><span class="g-Whitespace"> </span><span class="go">-27,40</span><span class="g-Whitespace"> </span><span class="go">+27,28</span><span class="g-Whitespace"> </span><span class="go">@@</span><span class="g-Whitespace"></span>
<span class="g-Whitespace"> </span><span class="go">cmake_minimum_required(VERSION</span><span class="g-Whitespace"> </span><span class="go">2.6.0</span><span class="g-Whitespace"> </span><span class="go">FATAL_ERROR)</span><span class="g-Whitespace"></span>
<span class="g-Whitespace"> </span><span class="go">project(Boost)</span><span class="g-Whitespace"></span>

<span class="go">(etc</span><span class="g-Whitespace"> </span><span class="go">etc)</span><span class="g-Whitespace"></span>
</pre></div>
</div>
<p>Now to apply to svn.  <a class="footnote-reference" href="#quickpatch" id="id1">[1]</a> Note that the patch above has
leading paths a/ and b/; for this reason you need the flag <tt class="docutils literal"><span class="pre">-p1</span></tt> to
have <tt class="docutils literal"><span class="pre">patch</span></tt> strip the first pathname component:</p>
<div class="highlight-git_shell"><div class="highlight"><pre><span class="k">% git</span><span class="g-Whitespace"> </span><span class="gd">diff </span><span class="o">-p </span>svn/master<span class="g-Whitespace"> </span>&gt;<span class="g-Whitespace"> </span><span class="g-Constant">/tmp/svn/cmake</span>.patch<span class="g-Whitespace"></span>
<span class="k">% </span>cd /tmp/svn
<span class="k">% </span>patch -p1 &lt; cmake.patch
<span class="go">patching</span><span class="g-Whitespace"> </span><span class="go">file</span><span class="g-Whitespace"> </span><span class="go">CMakeLists.txt</span><span class="g-Whitespace"></span>
<span class="go">patching</span><span class="g-Whitespace"> </span><span class="go">file</span><span class="g-Whitespace"> </span><span class="go">libs/flyweight/CMakeLists.txt</span><span class="g-Whitespace"></span>
<span class="go">patching</span><span class="g-Whitespace"> </span><span class="go">file</span><span class="g-Whitespace"> </span><span class="go">libs/flyweight/test/CMakeLists.txt</span><span class="g-Whitespace"></span>
</pre></div>
</div>
<p>Note that if the patch adds or removes files, svn won&#8217;t be told it
should commit them:</p>
<div class="highlight-git_shell"><div class="highlight"><pre><span class="k">% </span>svn status
<span class="go">?</span><span class="g-Whitespace">      </span><span class="go">libs/flyweight/CMakeLists.txt</span><span class="g-Whitespace"></span>
<span class="go">?</span><span class="g-Whitespace">      </span><span class="go">libs/flyweight/test/CMakeLists.txt</span><span class="g-Whitespace"></span>
<span class="go">M</span><span class="g-Whitespace">      </span><span class="go">CMakeLists.txt</span><span class="g-Whitespace"></span>
</pre></div>
</div>
<p>(nor will file permissions, etc, be handled).  You&#8217;ll have to
add/remove these files by hand with <tt class="docutils literal"><span class="pre">svn</span> <span class="pre">add</span></tt> and <tt class="docutils literal"><span class="pre">svn</span> <span class="pre">rm</span></tt>, e.g.:</p>
<div class="highlight-git_shell"><div class="highlight"><pre><span class="k">% </span>svn rm `svn status | grep ^! | awk &#39;{ print $2 }&#39;`
<span class="go">D</span><span class="g-Whitespace">         </span><span class="go">tools/build/CMake/BoostBuildSlave.cmake</span><span class="g-Whitespace"></span>
<span class="go">D</span><span class="g-Whitespace">         </span><span class="go">tools/build/CMake/run_continuous_slave.py.in</span><span class="g-Whitespace"></span>
<span class="go">D</span><span class="g-Whitespace">         </span><span class="go">tools/build/CMake/post.py.in</span><span class="g-Whitespace"></span>
<span class="k">% </span>svn add `svn status | grep ^\? | awk &#39;{ print $2 }&#39;`
<span class="go">A</span><span class="g-Whitespace">         </span><span class="go">CTestConfig.cmake</span><span class="g-Whitespace"></span>
</pre></div>
</div>
<p>And then commit at will.  The commits will work their way through
subversion, to the upstream git, to the gitorious mirror, and into
your codebase at your next fetch/merge/pull.</p>
<p>Note that the process is a little lossy as various git commits become
one svn commit with a possibly different comment.  You can use <strong>git
format-patch</strong> to make a bunch of patch files containing commit messages,
like this:</p>
<div class="highlight-git_shell"><div class="highlight"><pre><span class="k">% git</span><span class="g-Whitespace"> </span><span class="gd">format-patch </span>svn/master<span class="g-Whitespace"></span>
<span class="go">0001-.patch</span><span class="g-Whitespace"></span>
<span class="go">0002-.patch</span><span class="g-Whitespace"></span>
<span class="go">0003-.patch</span><span class="g-Whitespace"></span>

<span class="k">% </span>cat 0001-.patch
<span class="go">From</span><span class="g-Whitespace"> </span><span class="go">559336b1b4666db55c2c78d3ee11fff47b552cf0</span><span class="g-Whitespace"> </span><span class="go">Mon</span><span class="g-Whitespace"> </span><span class="go">Sep</span><span class="g-Whitespace"> </span><span class="go">17</span><span class="g-Whitespace"> </span><span class="go">00:00:00</span><span class="g-Whitespace"> </span><span class="go">2001</span><span class="g-Whitespace"></span>
<span class="go">From:</span><span class="g-Whitespace"> </span><span class="go">troy</span><span class="g-Whitespace"> </span><span class="go">&lt;troy@resophonic.com&gt;</span><span class="g-Whitespace"></span>
<span class="go">Date:</span><span class="g-Whitespace"> </span><span class="go">Fri,</span><span class="g-Whitespace"> </span><span class="go">24</span><span class="g-Whitespace"> </span><span class="go">Apr</span><span class="g-Whitespace"> </span><span class="go">2009</span><span class="g-Whitespace"> </span><span class="go">10:41:07</span><span class="g-Whitespace"> </span><span class="go">-0400</span><span class="g-Whitespace"></span>
<span class="go">Subject:</span><span class="g-Whitespace"> </span><span class="go">[PATCH]</span><span class="g-Whitespace"> </span><span class="go">Stop</span><span class="g-Whitespace"> </span><span class="go">compiler</span><span class="g-Whitespace"> </span><span class="go">warnings</span><span class="g-Whitespace"></span>

<span class="go">---</span><span class="g-Whitespace"></span>
<span class="g-Whitespace"> </span><span class="go">libs/serialization/src/basic_xml_grammar.ipp</span><span class="g-Whitespace"> </span><span class="go">|</span><span class="g-Whitespace">    </span><span class="go">6</span><span class="g-Whitespace"> </span><span class="go">+++---</span><span class="g-Whitespace"></span>
<span class="g-Whitespace"> </span><span class="go">1</span><span class="g-Whitespace"> </span><span class="go">files</span><span class="g-Whitespace"> </span><span class="go">changed,</span><span class="g-Whitespace"> </span><span class="go">3</span><span class="g-Whitespace"> </span><span class="go">insertions(+),</span><span class="g-Whitespace"> </span><span class="go">3</span><span class="g-Whitespace"> </span><span class="go">deletions(-)</span><span class="g-Whitespace"></span>

<span class="go">diff</span><span class="g-Whitespace"> </span><span class="go">--git</span><span class="g-Whitespace"> </span><span class="go">a/libs/serialization/src/basic_xml_grammar.ipp</span><span class="g-Whitespace"> </span><span class="go">b/libs/serialization/src/basic_xml_grammar.ipp</span><span class="g-Whitespace"></span>
<span class="go">index</span><span class="g-Whitespace"> </span><span class="go">07dc9a5..103af9d</span><span class="g-Whitespace"> </span><span class="go">100644</span><span class="g-Whitespace"></span>
<span class="go">---</span><span class="g-Whitespace"> </span><span class="go">a/libs/serialization/src/basic_xml_grammar.ipp</span><span class="g-Whitespace"></span>
<span class="go">+++</span><span class="g-Whitespace"> </span><span class="go">b/libs/serialization/src/basic_xml_grammar.ipp</span><span class="g-Whitespace"></span>
<span class="go">@@</span><span class="g-Whitespace"> </span><span class="go">-17,9</span><span class="g-Whitespace"> </span><span class="go">+17,9</span><span class="g-Whitespace"> </span><span class="go">@@</span><span class="g-Whitespace"></span>
<span class="g-Whitespace"> </span><span class="go">#include</span><span class="g-Whitespace"> </span><span class="go">&lt;boost/config.hpp&gt;</span><span class="g-Whitespace"> </span><span class="go">//</span><span class="g-Whitespace"> </span><span class="go">BOOST_DEDUCED_TYPENAME</span><span class="g-Whitespace"></span>

<span class="g-Whitespace"> </span><span class="go">//</span><span class="g-Whitespace"> </span><span class="go">spirit</span><span class="g-Whitespace"> </span><span class="go">stuff</span><span class="g-Whitespace"></span>
<span class="go">-#include</span><span class="g-Whitespace"> </span><span class="go">&lt;boost/spirit/core/composite/operators.hpp&gt;</span><span class="g-Whitespace"></span>
<span class="go">-#include</span><span class="g-Whitespace"> </span><span class="go">&lt;boost/spirit/core/composite/actions.hpp&gt;</span><span class="g-Whitespace"></span>
</pre></div>
</div>
<p>Buuuut svn doesn&#8217;t know what to do with these things.  I suppose you&#8217;d
have to write a little script to apply the patches and commit them
with their original log messages.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="quickpatch" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>A quicker way, if you keep a clean subversion
checkout laying around in <tt class="docutils literal"><span class="pre">/tmp/svn</span></tt>:
<tt class="docutils literal"><span class="pre">git</span> <span class="pre">diff</span> <span class="pre">origin/release</span> <span class="pre">|</span> <span class="pre">(cd</span> <span class="pre">/tmp/svn</span> <span class="pre">;</span>
<span class="pre">patch</span> <span class="pre">-p1)</span></tt></td></tr>
</tbody>
</table>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="svn_equivs.html" title="SVN Command equivalents"
             >next</a> |</li>
        <li class="right" >
          <a href="development.html" title="Do some development"
             >previous</a> |</li>
    <li><a href="http://www.boost.org/">Boost</a> &raquo;</li>
    
        <li><a href="index.html">Gitting boost</a> &raquo;</li>
 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2009, troy d. straszheim --  Version 4fda2016a1c5780c032675b9c4754dd0f3f413ce, Thu, 15 Oct 2009.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.2.
    </div>
  </body>
</html>